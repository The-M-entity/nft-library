name: Combine NFT Files

on:
  push:
    branches:
      - main
    paths:
      - 'data/*.json'

permissions:
  contents: write

jobs:
  combine:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Combine NFT files into nfts.json
        run: |
          # Start JSON array
          echo '[' > data/nfts.json
          
          # Find all JSON files except nfts.json, settings.json
          first=true
          for file in data/*.json; do
            filename=$(basename "$file")
            if [[ "$filename" != "nfts.json" && "$filename" != "settings.json" ]]; then
              if [ "$first" = true ]; then
                first=false
              else
                echo ',' >> data/nfts.json
              fi
              cat "$file" >> data/nfts.json
            fi
          done
          
          # Close JSON array
          echo ']' >> data/nfts.json
      
      - name: Commit and push
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add data/nfts.json
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Auto: Update combined nfts.json"
            git push
          fi
